<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plaquette forum alternance</title>
    <link rel="stylesheet" href="Protodesign.css">
    </head>
<body>
    <input type="checkbox" id="menu-toggle">
    <label for="menu-toggle" class="hamburger">☰ Filtres</label>

    <div class="filters">
        <div style="display: none;" class="filtreVille">
            <label><input type="checkbox" class="filterVille" value="Angers"> Angers</label>
            <label><input type="checkbox" class="filterVille" value="Brest"> Brest</label>
            <label><input type="checkbox" class="filterVille" value="Caen"> Caen</label>
        </div>
        <div class="filtreEcole">
            <label><input type="checkbox" class="filterEcole" value="IFAG"> IFAG</label>
            <label><input type="checkbox" class="filterEcole" value="LIT"> LEARN IT</label>
            <label><input type="checkbox" class="filterEcole" value="SDC"> SUP'DE COM</label>
            <label><input type="checkbox" class="filterEcole" value="LDS"> LA DIGITAL SCHOOL</label>
            <label><input type="checkbox" class="filterEcole" value="HTBS"> HOSPITALITY AND TOURISM BUSINESS SCHOOL</label>
            <label><input type="checkbox" class="filterEcole" value="SIMMO"> SUP IMMO</label>
            <label><input type="checkbox" class="filterEcole" value="SSB"> SCHOOL OF SPORT BUSINESS</label>
            <label><input type="checkbox" class="filterEcole" value="SDM"> SUPDEMOD</label>
            <label><input type="checkbox" class="filterEcole" value="PPI"> BAC+2 FORMATION PRÉPA PROFESSIONNELLE INTÉGRÉE</label>
        </div>
    </div>
    <div>
        <input type="text" id="filterPoste" placeholder="Recherche par poste">
    </div>
    <div class="container" id="cardsContainer"></div>

    <script>
        async function fetchData() {
            const cacheBuster = new Date().getTime();
            const response = await fetch(`https://forum-alternance.pages.dev/BDD_Form_Alt_OC.json?v=${cacheBuster}`);
                        return await response.json();
        }

        let data = {};

        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        const ecoleColorsRGB = {
            "IFAG": { "R": 220, "V": 13, "B": 21 },
            "LIT": { "R": 242, "V": 189, "B": 47 },
            "SDC": { "R": 10, "V": 0, "B": 79 },
            "LDS": { "R": 231, "V": 43, "B": 90 },
            "HTBS": { "R": 181, "V": 36, "B": 41 },
            "SIMMO": { "R": 241, "V": 135, "B": 0 },
            "SSB": { "R": 239, "V": 126, "B": 170 },
            "SDM": { "R": 226, "V": 0, "B": 123 },
            "PPI": { "R": 239, "V": 125, "B": 0 }
        };

        const ecoleLogos = {
            "IFAG": "https://reseau-opencampus.com/wp-content/uploads/2023/10/IFAG_BlocMarque_fond_rouge-e1697102618880.png",
            "LIT": "https://reseau-opencampus.com/wp-content/uploads/2025/02/Logo-Learn-IT-659x709-1.png",
            "SDC": "https://reseau-opencampus.com/wp-content/uploads/2025/02/Logo-SDC-659x709-1.png",
            "LDS": "https://reseau-opencampus.com/wp-content/uploads/2025/02/LDS_bloc_blanc_300dpi.png",
            "HTBS": "https://reseau-opencampus.com/wp-content/uploads/2025/02/Logo-HTBS-659x709-1.png",
            "SIMMO": "https://reseau-opencampus.com/wp-content/uploads/2020/12/SUPIMMOGRAS.png",
            "SSB": "https://reseau-opencampus.com/wp-content/uploads/2025/02/Logo-SSB-659x709-1.png",
            "SDM": "https://reseau-opencampus.com/wp-content/uploads/2025/02/Logo-SupdeMod-659x709-1.png",
            "PPI": "https://reseau-opencampus.com/wp-content/uploads/2025/02/Logo-Open-campus-659x709-1.png"
        };

        function createCards(filteredData) {
            const container = document.getElementById("cardsContainer");
            container.innerHTML = "";

            Object.values(filteredData).forEach(item => {
                const card = document.createElement("div");
                card.className = "card";

                const schoolColor = ecoleColorsRGB[item.Ecole] || { R: 204, V: 204, B: 204 }; 
                const schoolLogo = ecoleLogos[item.Ecole] || "";

                card.style.backgroundColor = `rgba(${schoolColor.R}, ${schoolColor.V}, ${schoolColor.B}, 0.02)`;
                card.style.position = "relative";

                card.innerHTML = `
                    <div class="card">
                        <div class="card-content">
                            <div class="card-body">
                                <div class="card-col1">
                                    <img src="${item["Logo entreprise"]}" alt="${item.Entreprise} logo" class="entreprise-logo">
                                </div>
                                <div class="card-col2">
                                    <div class="card-title">
                                        <h3>${item.Entreprise}</h3>
                                        <p class="horaire">${item["Horaire présence"]}</p>
                                    </div>
                                    <span class="poste-principal">${item["Liste poste"][0]}</span>
                                        <p class="description">${item.Description}</p>
                                    </div>
                                <div class="card-col3" >
                                    <div class="ecole-logo-container" style="background-color: rgba(${schoolColor.R}, ${schoolColor.V}, ${schoolColor.B},0.7);">
                                        <img src="${schoolLogo}" alt="${item.Ecole} logo" class="ecole-logo">
                                    </div>
                                    <span class="nb-postes">${item["Nb poste"]}<br> ${item["Nb poste"] > 1 ? "postes" : "poste"}</span>
                                </div>
                            </div>
                        <div class="site-web" style="background-color: rgba(${schoolColor.R}, ${schoolColor.V}, ${schoolColor.B},1);">
                        <a href="${item["URL Entreprise"]}" target="_blank" class="btn-site">Visiter le site</a>
                        </div>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function applyFilters() {
            const selectedVilles = Array.from(document.querySelectorAll(".filterVille:checked")).map(input => input.value);
            const selectedEcoles = Array.from(document.querySelectorAll(".filterEcole:checked")).map(input => input.value);
            const filterPoste = document.getElementById("filterPoste").value.toLowerCase();

            const filteredData = Object.values(data).filter(item => {
                return (
                    (selectedVilles.length === 0 || selectedVilles.includes(item.Ville)) &&
                    (selectedEcoles.length === 0 || selectedEcoles.includes(item.Ecole)) &&
                    (filterPoste === "" || item["Liste poste"].some(poste => poste.toLowerCase().includes(filterPoste)))
                );
            });

            createCards(filteredData);
        }

        // Initial setup
        document.addEventListener("DOMContentLoaded", async () => {
            data = await fetchData();
            createCards(data);

            // Pre-check ville if URL param exists
            const villeParam = getQueryParam("ville");
            if (villeParam) {
                const villeCheckbox = document.querySelector(`.filterVille[value='${villeParam}']`);
                if (villeCheckbox) {
                    villeCheckbox.checked = true;
                }
            }

            // Pre-check ecole if URL param exists
            const ecoleParam = getQueryParam("ecole");
            if (ecoleParam) {
                const ecoleCheckbox = document.querySelector(`.filterEcole[value='${ecoleParam}']`);
                if (ecoleCheckbox) {
                    ecoleCheckbox.checked = true;
                }
            }


            applyFilters();

            // Add event listeners for filters
            document.querySelectorAll(".filterVille").forEach(input => {
                input.addEventListener("change", applyFilters);
            });

            document.querySelectorAll(".filterEcole").forEach(input => {
                input.addEventListener("change", applyFilters);
            });

            document.getElementById("filterPoste").addEventListener("input", applyFilters);
        });
    </script>
</body>
</html>
